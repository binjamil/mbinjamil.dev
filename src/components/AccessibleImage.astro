---
import { Image } from "astro:assets";

type Props = { name: string; alt: string; width?: number };

const { name, alt, width } = Astro.props;
---

<Image
  class="lightImage"
  src={import(`../assets/${name}-light.png`)}
  alt={alt}
  width={width}
/>
<Image
  class="darkImage"
  src={import(`../assets/${name}-dark.png`)}
  alt={alt}
  width={width}
/>

<script>
  function setupImage() {
    function handleImageToggle() {
      const isDark = document.querySelector("html")?.classList.contains("dark");
      if (isDark) {
        for (let el of document.querySelectorAll(".lightImage")) {
          el.style.display = "none";
        }
        for (let el of document.querySelectorAll(".darkImage")) {
          el.style.display = "block";
        }
      } else {
        for (let el of document.querySelectorAll(".darkImage")) {
          el.style.display = "none";
        }
        for (let el of document.querySelectorAll(".lightImage")) {
          el.style.display = "block";
        }
      }
    }

    handleImageToggle();

    const themeToggle = document.getElementById("themeToggle");
    if (themeToggle) themeToggle.addEventListener("click", handleImageToggle);
  }

  setupImage();
  document.addEventListener("astro:after-swap", setupImage);
</script>
